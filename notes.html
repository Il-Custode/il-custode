<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title data-i18n="notes.page_title">Il Custode - Note Condivise</title>
  <style>
    :root{ --legno:#4b3621; --pelle:#d2b48c; --pelle-scura:#c2a178; --inchiostro:#3e2f1c; }
    *{ box-sizing:border-box }
    body{
      font-family:'Papyrus', fantasy; margin:0; padding:0; color:var(--inchiostro); text-align:center;
      background:url('./assets/img/sfondo-pergamena-decor.jpg') no-repeat center center fixed; background-size:cover;
    }
    .cornice{
      border:40px solid transparent; -webkit-border-image:url('./assets/img/cornice-legno.png') 40 stretch;
      border-image:url('./assets/img/cornice-legno.png') 40 stretch; min-height:100vh; display:flex; flex-direction:column;
    }
    header{
      position:relative; background-color:rgba(75,54,33,.85); color:#fff8dc; padding:16px 20px;
      border-bottom:5px solid var(--legno); display:flex; align-items:center; justify-content:center; gap:10px; font-size:28px;
      padding-left:80px; /* spazio per .back-btn iniettato dal main */
    }
    .container{ width:100%; max-width:1100px; margin:0 auto; padding:22px 16px 40px; text-align:left; }
    .card{
      background:rgba(255,248,220,.9); border:3px solid var(--legno); border-radius:12px; padding:16px; margin:16px 0; box-shadow:0 4px 10px rgba(0,0,0,.12);
    }
    textarea{
      width:100%; min-height:420px; resize:vertical;
      background:rgba(255,255,255,.85); border:3px solid var(--legno); border-radius:12px; padding:12px;
      font-family:ui-monospace, Consolas, monospace; font-size:16px; line-height:1.4;
    }
    .actions{ display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; margin-top:10px; }
    .btn{
      background:var(--pelle); border:3px solid var(--legno); padding:10px 14px; border-radius:10px; cursor:pointer; font-family:'Papyrus', fantasy; font-size:16px;
    }
    .btn:hover{ background:var(--pelle-scura); }
    .muted{ font-size:13px; opacity:.85; }
  </style>
</head>
<body>
<div class="cornice">
  <header>‚úíÔ∏è <span data-i18n="notes.title">Note Condivise</span> ‚úíÔ∏è</header>

  <div class="container">
    <section class="card">
      <textarea id="notes" data-i18n-placeholder="notes.placeholder" placeholder="Scrivi qui le note condivise‚Ä¶"></textarea>
      <div class="actions">
        <button id="btnSave" class="btn" data-i18n="notes.save">üíæ Salva Note</button>
      </div>
      <p id="status" class="muted"></p>
    </section>
  </div>
</div>

<!-- i18n -->
<script src="./assets/js/i18n.js"></script>
<script>
  (function(){
    const KEY = 'custode.root.notes';
    const notesEl = document.getElementById('notes');
    const statusEl = document.getElementById('status');
    const btnSave = document.getElementById('btnSave');

    function setStatus(msg){
      statusEl.textContent = msg || '';
      if (msg) setTimeout(()=>{ statusEl.textContent=''; }, 1200);
    }

    function load(){
      try{
        const raw = localStorage.getItem(KEY);
        notesEl.value = raw || '';
      }catch{}
    }
    function save(){
      try{
        localStorage.setItem(KEY, notesEl.value || '');
        const ok = (window.i18n && window.i18n.t) ? (window.i18n.t('notes.saved') || 'Salvato') : 'Salvato';
        setStatus(ok);
      }catch(e){
        setStatus('Errore salvataggio');
      }
    }

    btnSave.addEventListener('click', save);
    // Ctrl/Cmd+S
    document.addEventListener('keydown', (e)=>{
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's') { e.preventDefault(); save(); }
    });

    // Applica i18n al volo anche su titolo finestra
    function applyI18nExtras(){
      if (window.i18n && window.i18n.t){
        document.title = window.i18n.t('notes.page_title') || 'Il Custode - Note Condivise';
        // placeholder √® gestito da data-i18n-placeholder via i18n.apply()
      }
    }
    window.addEventListener('i18n:change', applyI18nExtras);

    // start
    load();
    applyI18nExtras();
  })();
</script>
</body>
</html>
